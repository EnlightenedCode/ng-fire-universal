"use strict";!function(){if(!("onload"in XMLHttpRequest.prototype)||navigator.standalone)return;const capableDisplayModes=["standalone","fullscreen","minimal-ui"],defaultSplashColor="#f8f9fa",defaultSplashTextSize=24,idealSplashIconSize=128,minimumSplashIconSize=48,splashIconPadding=32,userAgent=navigator.userAgent||"",isSafari=navigator.vendor&&-1!==navigator.vendor.indexOf("Apple"),isSafariMobile=isSafari&&-1!==userAgent.indexOf("Mobile/"),isIEOrEdge=Boolean(userAgent.match(/(MSIE |Edge\/|Trident\/)/)),isEdgePWA="undefined"!=typeof Windows;function setup(){const manifestEl=document.head.querySelector('link[rel="manifest"]'),manifestHref=manifestEl?manifestEl.href:"";if(!manifestHref)throw'can\'t find <link rel="manifest" href=".." />\'';const hrefFactory=buildHrefFactory([manifestHref,window.location]),xhr=new XMLHttpRequest;xhr.open("GET",manifestHref),xhr.withCredentials="use-credentials"===manifestEl.getAttribute("crossorigin"),xhr.onload=()=>{try{const data=JSON.parse(xhr.responseText);process(data,hrefFactory)}catch(err){console.warn("pwacompat.js error",err)}},xhr.send(null)}function buildHrefFactory(options){for(let i=0;i<options.length;++i){const opt=options[i];try{return new URL("",opt),part=>new URL(part||"",opt).toString()}catch(e){}}return part=>part||""}function push(localName,attr){const node=document.createElement(localName);for(const k in attr)node.setAttribute(k,attr[k]);return document.head.appendChild(node),node}function meta(name,content){content&&(!0===content&&(content="yes"),push("meta",{name:name,content:content}))}function process(manifest,urlFactory){const icons=manifest.icons||[];icons.sort((a,b)=>parseInt(b.sizes,10)-parseInt(a.sizes,10));const appleTouchIcons=icons.map(icon=>{const attr={rel:"icon",href:urlFactory(icon.src),sizes:icon.sizes};if(push("link",attr),!isSafariMobile)return;const dim=parseInt(icon.sizes,10);return dim<120?void 0:(attr.rel="apple-touch-icon",push("link",attr))}).filter(Boolean);if(appleTouchIcons.length){const last=appleTouchIcons[appleTouchIcons.length-1];last.removeAttribute("sizes")}const metaViewport=document.head.querySelector('meta[name="viewport"]'),viewport=metaViewport&&metaViewport.content||"",viewportFitCover=Boolean(viewport.match(/\bviewport-fit\s*=\s*cover\b/)),display=manifest.display,isCapable=-1!==capableDisplayModes.indexOf(display);if(meta("mobile-web-app-capable",isCapable),updateThemeColorRender(manifest.theme_color||"black",viewportFitCover),isIEOrEdge){meta("application-name",manifest.short_name),meta("msapplication-tooltip",manifest.description),meta("msapplication-starturl",urlFactory(manifest.start_url||".")),meta("msapplication-navbutton-color",manifest.theme_color);const largest=icons[0];largest&&meta("msapplication-TileImage",urlFactory(largest.src)),meta("msapplication-TileColor",manifest.background_color)}if(document.head.querySelector('[name="theme-color"]')||meta("theme-color",manifest.theme_color),!isSafariMobile){const orientation=simpleOrientationFor(manifest.orientation);return meta("x5-orientation",orientation),meta("screen-orientation",orientation),void("fullscreen"===display?(meta("x5-fullscreen","true"),meta("full-screen","yes")):isCapable&&(meta("x5-page-mode","app"),meta("browsermode","application")))}const backgroundIsLight=shouldUseLightForeground(manifest.background_color||defaultSplashColor),itunes=findAppleId(manifest.related_applications);function splashFor({width:width,height:height},orientation,icon){const ratio=window.devicePixelRatio,ctx=contextForCanvas({width:width*ratio,height:height*ratio});if(ctx.scale(ratio,ratio),ctx.fillStyle=manifest.background_color||defaultSplashColor,ctx.fillRect(0,0,width,height),ctx.translate(width/2,(height-splashIconPadding)/2),icon){let iconWidth=icon.width/ratio,iconHeight=icon.height/ratio;iconHeight>idealSplashIconSize&&(iconWidth/=iconHeight/idealSplashIconSize,iconHeight=idealSplashIconSize),iconWidth>=minimumSplashIconSize&&iconHeight>=minimumSplashIconSize&&(ctx.drawImage(icon,iconWidth/-2,iconHeight/-2,iconWidth,iconHeight),ctx.translate(0,iconHeight/2+splashIconPadding))}ctx.fillStyle=backgroundIsLight?"white":"black",ctx.font=`${defaultSplashTextSize}px Helvetica-Bold`;const title=manifest.name||manifest.short_name||document.title,textWidth=ctx.measureText(title).width;if(textWidth<.8*width)ctx.fillText(title,textWidth/-2,0);else{const words=title.split(/\s+/g);for(let i=1;i<=words.length;++i){const cand=words.slice(0,i).join(" "),measureWidth=ctx.measureText(cand).width;(i===words.length||measureWidth>.6*width)&&(ctx.fillText(cand,measureWidth/-2,0),ctx.translate(0,1.2*defaultSplashTextSize),words.splice(0,i),i=0)}}return()=>{const generatedSplash=document.createElement("link");return generatedSplash.setAttribute("rel","apple-touch-startup-image"),generatedSplash.setAttribute("media",`(orientation: ${orientation})`),generatedSplash.setAttribute("href",ctx.canvas.toDataURL()),generatedSplash}}function renderBothSplash(applicationIcon){const portrait=splashFor(window.screen,"portrait",applicationIcon),landscape=splashFor({width:window.screen.height,height:window.screen.width},"landscape",applicationIcon);window.setTimeout(()=>{document.head.appendChild(portrait()),window.setTimeout(()=>{document.head.appendChild(landscape())},10)},10)}itunes&&meta("apple-itunes-app",`app-id=${itunes}`),meta("apple-mobile-web-app-capable",isCapable),meta("apple-mobile-web-app-title",manifest.short_name||manifest.name);const icon=appleTouchIcons[0],img=new Image;img.crossOrigin="anonymous",img.onerror=()=>{renderBothSplash()},appleTouchIcons.length?(img.onload=()=>{if(renderBothSplash(img),!manifest.background_color)return;const redrawn=updateTransparent(img,manifest.background_color);redrawn&&(icon.href=redrawn,appleTouchIcons.slice(1).forEach(icon=>{const img=new Image;img.crossOrigin="anonymous",img.onload=()=>{const redrawn=updateTransparent(img,manifest.background_color,!0);icon.href=redrawn},img.src=icon.href}))},img.src=icon.href):img.onerror()}function findAppleId(related){let itunes;return(related||[]).filter(app=>"itunes"===app.platform).forEach(app=>{if(app.id)itunes=app.id;else{const match=app.url.match(/id(\d+)/);match&&(itunes=match[1])}}),itunes}function simpleOrientationFor(v){const prefix=String(v||"").substr(0,3);return{por:"portrait",lan:"landscape"}[prefix]||""}function updateThemeColorRender(color,viewportFitCover){if(!isSafariMobile&&!isEdgePWA)return;const themeIsLight=shouldUseLightForeground(color);if(isSafariMobile){const content="black-translucent";meta("apple-mobile-web-app-status-bar-style",content)}else{const t=getEdgeTitleBar();if(!t)return;t.foregroundColor=colorToWindowsRGBA(themeIsLight?"black":"white"),t.backgroundColor=colorToWindowsRGBA(color)}}function getEdgeTitleBar(){try{return Windows.UI.ViewManagement.ApplicationView.getForCurrentView().titleBar}catch(e){}}function colorToWindowsRGBA(color){const data=readColor(color);return{r:data[0],g:data[1],b:data[2],a:data[3]}}function readColor(color){const c=contextForCanvas();return c.fillStyle=color,c.fillRect(0,0,1,1),c.getImageData(0,0,1,1).data}function shouldUseLightForeground(color){const pixelData=readColor(color),data=pixelData.map(v=>{const f=v/255;return f<.03928?f/12.92:Math.pow((f+.055)/1.055,2.4)}),lum=.2126*data[0]+.7152*data[1]+.0722*data[2],contrast=Math.abs(1.05/(lum+.05));return contrast>3}function updateTransparent(image,background,force=!1){const context=contextForCanvas(image);if(context.drawImage(image,0,0),!force){const imageData=context.getImageData(0,0,1,1);if(255==imageData.data[3])return}return context.globalCompositeOperation="destination-over",context.fillStyle=background,context.fillRect(0,0,image.width,image.height),context.canvas.toDataURL()}function contextForCanvas({width:width,height:height}={width:1,height:1}){const canvas=document.createElement("canvas");return canvas.width=width,canvas.height=height,canvas.getContext("2d")}"complete"===document.readyState?setup():window.addEventListener("load",setup)}();